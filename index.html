<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù…Ù‚Ø§Ø±Ù†Ø© Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø¨Ù‚Ø§Ù„Ø§Øª</title>
  <style>
    * { box-sizing: border-box; }
    body { font-family: system-ui, Tahoma, Arial; background:#f3f4f6; margin:0; }
    .page {
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 40px 10px;
    }
    .card {
      width: 100%;
      max-width: 750px;
      background:#ffffff;
      border-radius:16px;
      padding:24px 24px 30px;
      box-shadow:0 10px 30px rgba(15,23,42,0.12);
    }
    h1 {
      margin:0 0 6px;
      font-size: 26px;
    }
    .subtitle {
      margin:0 0 16px;
      color:#6b7280;
      font-size:14px;
    }
    .search-row {
      display:flex;
      gap:8px;
      margin-bottom:16px;
    }
    input {
      flex:1;
      padding:10px 12px;
      border-radius: 999px;
      border:1px solid #d1d5db;
      font-size:14px;
      outline:none;
    }
    input:focus {
      border-color:#22c55e;
      box-shadow:0 0 0 1px rgba(34,197,94,0.3);
    }
    button {
      padding:10px 18px;
      border-radius:999px;
      border:none;
      background:#22c55e;
      color:white;
      font-size:14px;
      cursor:pointer;
      font-weight:600;
      white-space: nowrap;
    }
    button:hover { background:#16a34a; }
    .hint {
      font-size:12px;
      color:#9ca3af;
      margin-bottom:8px;
    }
    .results {
      margin-top:10px;
    }
    .result {
      margin-top:10px;
      padding:10px 12px;
      background:#f9fafb;
      border-radius:10px;
      border:1px solid #e5e7eb;
      font-size:14px;
    }
    .result.best {
      border:2px solid #22c55e;
      background:#ecfdf3;
    }
    .store {
      font-weight:600;
    }
    .price {
      font-weight:700;
      color:#16a34a;
    }
    .link {
      font-size:12px;
      margin-top:4px;
    }
    .badge {
      display:inline-block;
      font-size:11px;
      background:#22c55e;
      color:white;
      border-radius:999px;
      padding:2px 8px;
      margin-right:6px;
    }
  </style>
</head>
<body>

<div class="page">
  <div class="card">
    <h1>ğŸ›’ Ù…Ù‚Ø§Ø±Ù†Ø© Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø¨Ù‚Ø§Ù„Ø§Øª</h1>
    <p class="subtitle">Ù‚Ø§Ø±Ù† Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨ÙŠÙ† Ù„ÙˆÙ„ÙˆØŒ Ø§Ù„Ø¹Ø«ÙŠÙ…ØŒ ÙˆØ¨Ù†Ø¯Ø© ÙˆØ´ÙˆÙ Ø§Ù„Ø£Ø±Ø®Øµ Ù…Ø¨Ø§Ø´Ø±Ø©.</p>

    <div class="hint">Ø¬Ø±Ù‘Ø¨: <b>Ø­Ù„ÙŠØ¨</b> Ø£Ùˆ <b>Ø±Ø²</b> Ø£Ùˆ <b>Ù…Ø§Ø¡</b></div>

    <div class="search-row">
      <input id="q" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ (Ù…Ø«Ù„Ø§Ù‹: Ø­Ù„ÙŠØ¨ Ø§Ù„Ù…Ø±Ø§Ø¹ÙŠ Ø£Ùˆ Ø±Ø² Ø¨Ø³Ù…ØªÙŠ)">
      <button onclick="search()">Ø¨Ø­Ø«</button>
    </div>

    <div id="results" class="results"></div>
  </div>
</div>

<script>
async function search() {
  const q = document.getElementById('q').value.trim();
  const resultsDiv = document.getElementById('results');
  resultsDiv.innerHTML = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...";

  try {
    const response = await fetch("http://127.0.0.1:8000/search?q=" + encodeURIComponent(q));

    if (!response.ok) {
      resultsDiv.innerHTML = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±. Ø§Ù„ÙƒÙˆØ¯: " + response.status;
      return;
    }

    const data = await response.json();
    resultsDiv.innerHTML = "";

    if (data.length === 0) {
      resultsDiv.innerHTML = "<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬.</p>";
      return;
    }

    const cheapest = data[0].price;

    data.forEach(function(item) {
      const div = document.createElement("div");
      const isBest = item.price === cheapest;
      div.className = "result" + (isBest ? " best" : "");

      let header = "";
      if (isBest) {
        header += '<span class="badge">Ø§Ù„Ø£Ø±Ø®Øµ</span>';
      }

      header += '<span class="store">' + item.store + '</span>';
      const body =
        '<div>' + item.name + '</div>' +
        '<div class="price">' + item.price + ' Ø±ÙŠØ§Ù„</div>' +
        '<div class="link"><a href="' + item.url + '" target="_blank">ÙØªØ­ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø³ÙˆØ¨Ø±Ù…Ø§Ø±ÙƒØª</a></div>';

      div.innerHTML = header + "<br>" + body;
      resultsDiv.appendChild(div);
    });
  } catch (e) {
    console.error(e);
    resultsDiv.innerHTML = "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±.";
  }
}
</script>

</body>
</html>
